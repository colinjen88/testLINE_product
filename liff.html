<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <title>LINE å•†å“æ´½è©¢ LIFF</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>

<body>
    <h2>æ­£åœ¨ç™¼é€å•†å“æ´½è©¢è¨Šæ¯...</h2>
    <script>
        // å–å¾—ç¶²å€åƒæ•¸
        function getQueryParam(name) {
            const url = new URL(window.location.href);
            return url.searchParams.get(name) || '';
        }

        // è§£æå•†å“è³‡æ–™
        function parseProductData() {
            const productParam = getQueryParam('product');
            if (!productParam) {
                return { name: 'æœªçŸ¥å•†å“', store: 'æœªçŸ¥å“ç‰Œ', index: 0 };
            }

            try {
                // å˜—è©¦è§£æ JSON æ ¼å¼çš„å•†å“è³‡æ–™
                const productData = JSON.parse(decodeURIComponent(productParam));
                return productData;
            } catch (error) {
                // å¦‚æœè§£æå¤±æ•—ï¼Œå¯èƒ½æ˜¯èˆŠæ ¼å¼çš„å–®ä¸€å•†å“åç¨±
                console.warn('ç„¡æ³•è§£æå•†å“è³‡æ–™ï¼Œä½¿ç”¨èˆŠæ ¼å¼:', error);
                return { name: productParam, store: 'æœªçŸ¥å“ç‰Œ', index: 0 };
            }
        }

        const productInfo = parseProductData();

        // åˆå§‹åŒ– LIFF
        liff.init({ liffId: "2008115455-rgy2kjaA" })
            .then(() => {
                // æª¢æŸ¥æ˜¯å¦åœ¨ LINE App å…§
                if (!liff.isInClient()) {
                    document.body.innerHTML = "<h2>è«‹ç”¨ LINE App é–‹å•Ÿæœ¬é é¢</h2>";
                    return;
                }
                // ç™¼é€è¨Šæ¯
                const messageText = `ä½ å¥½ï¼Œæˆ‘æƒ³è©¢å•å•†å“è³‡è¨Šï¼š

ğŸ“¦ å•†å“åç¨±ï¼š${productInfo.name}
ğŸª å“ç‰Œï¼š${productInfo.store}
ğŸ†” å•†å“ç·¨è™Ÿï¼š${productInfo.index}

è«‹æä¾›æ­¤å•†å“çš„ä»Šæ—¥åƒ¹æ ¼èˆ‡åº«å­˜ç‹€æ³ï¼Œè¬è¬ï¼`;

                liff.sendMessages([
                    {
                        type: "text",
                        text: messageText
                    }
                ]).then(() => {
                    document.body.innerHTML = "<h2>å·²ç™¼é€è¨Šæ¯ï¼Œè«‹å›åˆ°èŠå¤©å®¤ï¼</h2>";
                    setTimeout(() => liff.closeWindow(), 1500);
                }).catch(err => {
                    document.body.innerHTML = "<h2>ç™¼é€å¤±æ•—ï¼š" + err.message + "</h2>";
                });
            })
            .catch(err => {
                document.body.innerHTML = "<h2>LIFF åˆå§‹åŒ–å¤±æ•—ï¼š" + err.message + "</h2>";
            });
    </script>
</body>

</html>